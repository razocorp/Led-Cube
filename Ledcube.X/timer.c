// =============================================================================
// Include statements
// =============================================================================
#include "timer.h"
#include "leds.h"
#include <xc.h>
// =============================================================================
// Private type definitions
// =============================================================================

// =============================================================================
// Global variables
// =============================================================================

// =============================================================================
// Private constants
// =============================================================================

// =============================================================================
// Private variables
// =============================================================================
static uint8_t layer = 0;
// =============================================================================
// Private function declarations
// =============================================================================

// =============================================================================
// Public function definitions
// =============================================================================

void timer_init(void){
    T1CON = 0;
    INTCONbits.GIE = 1;
    INTCONbits.PEIE = 1;
    PIE1bits.TMR1IE = 1;
    TMR1H = 0xF6;
    TMR1L = 0x3B;
    T1CONbits.TMR1ON = 1;
}

void interrupt isr(){
    static uint8_t prescaler = 0;
    if(PIR1bits.TMR1IF){
        PIR1bits.TMR1IF = 0;
        T1CONbits.TMR1ON = 0;
        TMR1H = 0xF6;
        TMR1L = 0x3B;
        T1CONbits.TMR1ON = 1;
   
        set_lights(layer);
        if(++layer == NBR_OF_LAYERS)
            layer = 0;
        
        if(++prescaler == 100){
            prescaler = 0;
            animation_flag = true;
        }
        
    }
}

// =============================================================================
// Private function definitions
// =============================================================================
